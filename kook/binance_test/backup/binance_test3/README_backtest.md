# 바이낸스 양방향봇7 백테스트

## 개요
바이낸스 양방향봇7의 전략을 백테스트할 수 있는 도구입니다. 실제 바이낸스 데이터를 사용하여 전략의 성과를 분석할 수 있습니다.

## 주요 특징
- **400등분 슬롯 관리**: 전체 자금을 400개 슬롯으로 나누어 분할 매수
- **MA 기반 신호**: 5일선과 20일선 교차를 이용한 진입/청산 신호
- **물타기 시스템**: 수익의 50%를 논리적 물타기로 적용
- **이벤트 기반 진입**: 1시간봉 기준 1.3% 이상 변동 시 진입
- **슬롯 추적**: 각 슬롯의 개별 진입가와 수익률 관리

## 파일 구조
```
binance_test2/
├── binance_yang_bot7_backtest.py          # 기본 백테스트 클래스 (샘플 데이터)
├── binance_yang_bot7_backtest_real.py     # 실제 바이낸스 데이터 백테스트
├── run_backtest.py                        # 백테스트 실행 스크립트
└── README_backtest.md                     # 이 파일
```

## 설치 및 설정

### 1. 필요한 라이브러리 설치
```bash
pip install pandas numpy matplotlib ccxt
```

### 2. 바이낸스 API 키 설정
`my_key.py` 파일에 바이낸스 API 키가 설정되어 있어야 합니다.

## 사용법

### 1. 기본 실행
```bash
python run_backtest.py
```

### 2. 커스텀 설정으로 실행
```python
from binance_yang_bot7_backtest_real import BinanceYangBot7RealBacktest

# 백테스트 설정
bot = BinanceYangBot7RealBacktest(
    initial_balance=10000,  # 초기 자본금
    leverage=40             # 레버리지
)

# 백테스트 실행
results = bot.run_backtest(
    symbol='BTC/USDT',
    start_date='2024-01-01',
    end_date='2024-01-31',
    timeframe='1m'
)

print(results)
```

## 전략 로직

### 1. 진입 조건
- **숏 진입**: 5일선 > 20일선이고 5일선이 하락추세로 꺾일 때
- **롱 진입**: 5일선 < 20일선이고 5일선이 상승추세로 꺾일 때

### 2. 청산 조건
- **숏 청산**: 5일선 < 20일선이고 5일선이 상승추세로 꺾일 때 + 목표 수익률 달성
- **롱 청산**: 5일선 > 20일선이고 5일선이 하락추세로 꺾일 때 + 목표 수익률 달성

### 3. 물타기 시스템
- 수익이 발생하면 수익의 50%를 논리적 물타기로 적용
- 기존 슬롯의 진입가를 조정하여 빠른 회수 목표

### 4. 반대 방향 진입
- 첫 슬롯이 `-target_revenue_rate` 이하로 떨어지면 반대 방향 진입 허용
- 같은 방향 재진입은 `-target_revenue_rate * 3`에서만 허용

## 백테스트 결과

### 주요 지표
- **총 수익률**: 백테스트 기간 동안의 총 수익률
- **최대 낙폭**: 최고점 대비 최대 하락률
- **승률**: 수익 거래의 비율
- **슬롯 사용률**: 400슬롯 중 사용된 비율

### 결과 파일
- JSON 형태로 상세한 거래 기록과 성과 지표 저장
- 잔고 변화, 슬롯 수 변화 등 시계열 데이터 포함

## 주의사항

1. **API 제한**: 바이낸스 API 호출 제한에 주의
2. **데이터 품질**: 실제 거래와 백테스트 결과는 차이가 있을 수 있음
3. **슬롯 관리**: 슬롯 수가 계속 늘어나는 문제가 있을 수 있음
4. **수수료**: 실제 수수료와 백테스트 수수료가 다를 수 있음

## 문제 해결

### 슬롯 수 증가 문제
현재 전략의 주요 문제점은 반대 방향 진입 시 슬롯이 계속 늘어나는 것입니다. 이를 해결하기 위한 아이디어:

1. **슬롯 압축**: 비슷한 손실률의 슬롯들을 하나로 합치기
2. **시간 기반 만료**: 일정 시간 후 강제 청산
3. **동적 슬롯 관리**: 시장 상황에 따라 슬롯 수 조절

## 라이선스
이 코드는 교육 및 연구 목적으로 제공됩니다.
