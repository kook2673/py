'''

ê´€ë ¨ í¬ìŠ¤íŒ…


ë¯¸êµ­ ì£¼ì‹ ì–‘ë°©í–¥ ë§¤ë§¤ ìµœì¢…íŒ (TQQQ / SQQQ, SOXL / SOXS) V2
https://blog.naver.com/zacra/223192576614

ìœ„ í¬ìŠ¤íŒ…ì„ ê¼­ ì°¸ê³ í•˜ì„¸ìš”!!!



ğŸ“Œ [ì½”ë“œ ì œê³µ ëª©ì ]

ì´ ì½”ë“œëŠ” í´ë˜ìŠ¤101 ê²Œë§Œì•„ <íŒŒì´ì¬ ìë™ë§¤ë§¤ ë´‡ ë§Œë“¤ê¸°> ê°•ì˜ì˜ ë³´ì¡° ìë£Œë¡œ ì œê³µë˜ë©°,  
ê°•ì˜ ìˆ˜ê°•ìƒì˜ **í•™ìŠµ ë° ì‹¤ìŠµì„ ìœ„í•œ ì°¸ê³ ìš© ì˜ˆì‹œ ì½”ë“œ**ì…ë‹ˆë‹¤.  
**íˆ¬ì ê¶Œìœ , ì¢…ëª© ì¶”ì²œ, ìë¬¸ ë˜ëŠ” ì¼ì„ì„ ìœ„í•œ ëª©ì ì€ ì „í˜€ ì—†ìŠµë‹ˆë‹¤.**

ğŸ“Œ [ê¸°ìˆ  êµ¬í˜„ ê´€ë ¨ ì•ˆë‚´]

- ë³¸ ì½”ë“œëŠ” **ì¦ê¶Œì‚¬ì—ì„œ ê³µì‹ì ìœ¼ë¡œ ì œê³µí•œ API** ë°  
  **ê³µì‹ ê°œë°œì ê°€ì´ë“œ ë¬¸ì„œ**ì— ë”°ë¼ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.
- í•´ë‹¹ APIëŠ” ì¼ë°˜ íˆ¬ìì ëˆ„êµ¬ë‚˜ ì´ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ì´ë©°,  
  ë³¸ ì½”ë“œëŠ” ê·¸ê²ƒì„ êµ¬í˜„í•œ ì˜ˆì‹œë¥¼ í™œìš©í•´ ì „ëµì„ êµ¬í˜„í•´ë³´ëŠ” í•™ìŠµ ëª©ì ìœ¼ë¡œ í™œìš©í•œ ê²ƒì…ë‹ˆë‹¤.

ğŸ“Œ [ì „ëµ ì‹¤í–‰ ì¡°ê±´]

- ë³¸ ì½”ë“œëŠ” ìë™ ë°˜ë³µ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë©°, ì‚¬ìš©ìê°€ ì§ì ‘ ì‹¤í–‰í•´ì•¼ 1íšŒ ë™ì‘í•©ë‹ˆë‹¤.
- ë°˜ë³µ ì‹¤í–‰ì„ ì›í•  ê²½ìš°, ì‚¬ìš©ìê°€ ë³„ë„ë¡œ ì„œë²„ ë° ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬ì„±ì„ í•´ì•¼ í•©ë‹ˆë‹¤.


- ë³¸ ì½”ë“œì—ëŠ” ì¦ê¶Œì‚¬ ì œê³µ APIë¥¼ í™œìš©í•œ ë§¤ë§¤ ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë‚˜,  
  **ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ” í•œ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
  

- ì „ëµ ì‹¤í–‰ì„ ìœ„í•´ì„œëŠ” ë‹¤ìŒì˜ ê³¼ì •ì„ **ì‚¬ìš©ìê°€ ì§ì ‘** ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤:

  1. `ENABLE_ORDER_EXECUTION` ê°’ì„ `True`ë¡œ ë³€ê²½  
  2. `InvestRate` ë¹„ì¤‘ì„ ì„¤ì • (ê¸°ë³¸ê°’: 0)  
  3. ë§¤ìˆ˜í•  ì¢…ëª©ì„ ëª…ì‹œ (ê¸°ë³¸ê°’: ë¹ˆ ë¦¬ìŠ¤íŠ¸)  
  4. AWS ë˜ëŠ” ê°œì¸ ì„œë²„ êµ¬ì¶• ë° `crontab` ë˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ ë“±ë¡

- ì œê³µìëŠ” ì„œë²„ êµ¬ì¶•, ì„¤ì •, ì‹¤í–‰ ëŒ€í–‰ ë“±ì„ ì „í˜€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ğŸ“Œ [ë²•ì  ì±…ì„ ê³ ì§€]

- ì œê³µë˜ëŠ” ì½”ë“œëŠ” ê¸°ìˆ  í•™ìŠµ ë° í…ŒìŠ¤íŠ¸ ëª©ì ì˜ ì˜ˆì‹œ ì½”ë“œì…ë‹ˆë‹¤.  
- **ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” ê³¼ê±° ë°ì´í„° ê¸°ë°˜ì´ë©°, ë¯¸ë˜ ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

- ë³¸ ì½”ë“œì˜ ì‚¬ìš©, ìˆ˜ì •, ì‹¤í–‰ì— ë”°ë¥¸ ëª¨ë“  ê²°ê³¼ì™€ ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìœ¼ë©°,  
  **ì œê³µìëŠ” ë²•ì Â·ê¸ˆì „ì  ì±…ì„ì„ ì¼ì ˆ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ğŸ“Œ [ì €ì‘ê¶Œ ì•ˆë‚´]

- ì´ ì½”ë“œëŠ” ì €ì‘ê¶Œë²• ë° ë¶€ì •ê²½ìŸë°©ì§€ë²•ì˜ ë³´í˜¸ë¥¼ ë°›ìŠµë‹ˆë‹¤.  
- ë¬´ë‹¨ ë³µì œ, ê³µìœ , ì¬íŒë§¤, ë°°í¬ ì‹œ ë¯¼Â·í˜•ì‚¬ìƒ ì±…ì„ì´ ë”°ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ“Œ [í•™ìŠµ ê¶Œì¥ ì‚¬í•­]

- ë³¸ ì˜ˆì‹œ ì½”ë“œëŠ” ì „ëµ êµ¬í˜„ì„ ì´í•´í•˜ê¸° ìœ„í•œ í…œí”Œë¦¿ì…ë‹ˆë‹¤.  
- ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìì‹ ë§Œì˜ ì „ëµì„ ê°œë°œí•´ë³´ì‹œê¸¸ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤ :)



ì£¼ì‹/ì½”ì¸ ìë™ë§¤ë§¤ FAQ
https://blog.naver.com/zacra/223203988739

FAQë¡œ í•´ê²° ì•ˆë˜ëŠ” ê¸°ìˆ ì ì¸ ë¬¸ì œëŠ” í´ë˜ìŠ¤101 ê°•ì˜ì˜ ëŒ“ê¸€ì´ë‚˜ ìœ„ í¬ìŠ¤íŒ…ì— ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì„¸ìš”.
íŒŒì´ì¬ ì½”ë”©ì— ëŒ€í•œ ë‹µë³€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. í˜„í–‰ë²• ìƒ íˆ¬ì ê´€ë ¨ ì§ˆë¬¸ì€ ë‹µë³€ ë¶ˆê°€í•˜ë‹¤ëŠ” ì  ì•Œë ¤ë“œë ¤ìš”!



'''
import KIS_Common as Common
import KIS_API_Helper_US as KisUS
import json
import pprint
import line_alert
import time

Common.SetChangeMode("VIRTUAL")



#####################################################################################################################################
'''
â€» ì£¼ë¬¸ ì‹¤í–‰ ì—¬ë¶€ ì„¤ì •

ENABLE_ORDER_EXECUTION ê°’ì„ Trueë¡œ ë³€ê²½í•  ê²½ìš°,  
ì „ëµì— ë”°ë¼ ë§¤ë§¤ê°€ ì¼ì–´ë‚©ë‹ˆë‹¤.

âš ï¸ ê¸°ë³¸ê°’ì€ Falseì´ë©°,  
ì‹¤í–‰ ì—¬ë¶€ëŠ” ì‚¬ìš©ì ë³¸ì¸ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ ê²°ì •í•´ì•¼ í•©ë‹ˆë‹¤.
'''

ENABLE_ORDER_EXECUTION = False  # ì£¼ë¬¸ ì‹¤í–‰ ì—¬ë¶€ ì„¤ì • (ê¸°ë³¸ê°’: False)

'''
ğŸ“Œ ë³¸ ì „ëµì€ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ëŠ” ì˜ˆì‹œ ì½”ë“œì´ë©°,  
ì‹¤ì œ íˆ¬ì ë° ì£¼ë¬¸ ì‹¤í–‰ì€ ì‚¬ìš©ì ë³¸ì¸ì˜ ì˜ì‚¬ì™€ ì±…ì„ í•˜ì— ìˆ˜í–‰ë©ë‹ˆë‹¤.
'''
#####################################################################################################################################

'''
ğŸ“Œ íˆ¬ìí•  ì¢…ëª©ì€ ë³¸ì¸ì˜ ì„ íƒìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”!
'''
InvestStockList = list()


InvestDataDict = dict()
InvestDataDict['ticker'] = "" #ë³¸ì¸ì˜ ì¢…ëª© ì…ë ¥
#InvestDataDict['ticker'] = "TQQQ" #ì˜ˆì‹œ
InvestDataDict['rate'] = 0.35

InvestStockList.append(InvestDataDict)

InvestDataDict = dict()
InvestDataDict['ticker'] = "" #ë³¸ì¸ì˜ ì¢…ëª© ì…ë ¥
#InvestDataDict['ticker'] = "SOXL" #ì˜ˆì‹œ
InvestDataDict['rate'] = 0.35

InvestStockList.append(InvestDataDict)

InvestDataDict = dict()
InvestDataDict['ticker'] = "" #ë³¸ì¸ì˜ ì¢…ëª© ì…ë ¥
#InvestDataDict['ticker'] = "SQQQ" #ì˜ˆì‹œ
InvestDataDict['rate'] = 0.15

InvestStockList.append(InvestDataDict)

InvestDataDict = dict()
InvestDataDict['ticker'] = "" #ë³¸ì¸ì˜ ì¢…ëª© ì…ë ¥
#InvestDataDict['ticker'] = "SOXS" #ì˜ˆì‹œ
InvestDataDict['rate'] = 0.15

InvestStockList.append(InvestDataDict)

#####################################################################################################################################


'''
ğŸ“Œ íˆ¬ì ë¹„ì¤‘ ì„¤ì •!
ê¸°ë³¸ì€ 0ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ìš”.
ë³¸ì¸ì˜ íˆ¬ì ë¹„ì¤‘ì„ ì„¤ì •í•˜ì„¸ìš”! 

ì „ëµì—ì„œ í™œìš©í•  ì£¼ë¬¸ì´ 
ì‹œì¥ê°€ ì£¼ë¬¸ì´ë¼ë©´ 0 ~ 0.75 
ì§€ì •ê°€ ì£¼ë¬¸ì´ë¼ë©´ 0 ~ 0.98
ì‚¬ì´ì˜ ê°’ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”! (0.1 = 10% 0.5 = 50%)
'''
InvestRate = 0 #ì´ í‰ê°€ê¸ˆì•¡ì—ì„œ í•´ë‹¹ ë´‡ì—ê²Œ í• ë‹¹í•  ì´ ê¸ˆì•¡ë¹„ìœ¨ 0.1 = 10%  0.5 = 50%
#####################################################################################################################################


BOT_NAME = Common.GetNowDist() + "_3xBothStrategyBotV2"





pprint.pprint(InvestStockList)


#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#
############# í•´ë‹¹ ì „ëµìœ¼ë¡œ ë§¤ìˆ˜í•œ ì¢…ëª© ë°ì´í„° ë¦¬ìŠ¤íŠ¸ ####################
InfinityUpgradeDataList = list()
#íŒŒì¼ ê²½ë¡œì…ë‹ˆë‹¤.
bot_file_path = "/var/autobot/UsStock_" + BOT_NAME + ".json"

try:
    #ì´ ë¶€ë¶„ì´ íŒŒì¼ì„ ì½ì–´ì„œ ë¦¬ìŠ¤íŠ¸ì— ë„£ì–´ì£¼ëŠ” ë¡œì§ì…ë‹ˆë‹¤. 
    with open(bot_file_path, 'r') as json_file:
        InfinityUpgradeDataList = json.load(json_file)

except Exception as e:
    print("Exception by First")
################################################################
#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#
#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$#


#ê³„ì¢Œ ì”ê³ ë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤!
Balance = KisUS.GetBalance()



print("--------------ë‚´ ë³´ìœ  ì”ê³ ---------------------")

pprint.pprint(Balance)



print("--------------------------------------------")


#ê¸°ì¤€ì´ ë˜ëŠ” ë‚´ ì´ í‰ê°€ê¸ˆì•¡
TotalMoney = float(Balance['TotalMoney']) * InvestRate
print("TotalMoney:", str(format(round(TotalMoney), ',')))


print("--------------ë‚´ ë³´ìœ  ì£¼ì‹---------------------")
#ê·¸ë¦¬ê³  í˜„ì¬ ì´ ê³„ì¢Œì—ì„œ ë³´ìœ í•œ ì£¼ì‹ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  ì˜µë‹ˆë‹¤!
MyStockList = KisUS.GetMyStockList()
pprint.pprint(MyStockList)
print("--------------------------------------------")
    
if ENABLE_ORDER_EXECUTION == True:

        
    #ë§ˆì¼“ì´ ì—´ë ¸ëŠ”ì§€ ì—¬ë¶€~!
    IsMarketOpen = KisUS.IsMarketOpen()

    #ì¥ì´ ì—´ë ¸ì„ ë•Œ!
    if IsMarketOpen == True:


        for stock_data in InvestStockList:

            stock_code = stock_data['ticker']

            print("\n----stock_code: ", stock_code)

            #ê° ì¢…ëª©ë‹¹ íˆ¬ìí•  ê¸ˆì•¡! 
            StockMoney = TotalMoney * stock_data['rate']
            print("StockMoney:", str(format(round(StockMoney), ',')))

            #ì£¼ì‹(ETF) ì •ë³´~
            stock_name = ""
            stock_amt = 0 #ìˆ˜ëŸ‰
            stock_avg_price = 0 #í‰ë‹¨
            stock_eval_totalmoney = 0 #ì´í‰ê°€ê¸ˆì•¡!
            stock_revenue_rate = 0 #ì¢…ëª© ìˆ˜ìµë¥ 
            stock_revenue_money = 0 #ì¢…ëª© ìˆ˜ìµê¸ˆ


            #ë§¤ìˆ˜ëœ ìƒíƒœë¼ë©´ ì •ë³´ë¥¼ ë„£ì–´ì¤€ë‹¤!!!
            for my_stock in MyStockList:
                if my_stock['StockCode'] == stock_code:
                    stock_name = my_stock['StockName']
                    stock_amt = int(my_stock['StockAmt'])
                    stock_avg_price = float(my_stock['StockAvgPrice'])
                    stock_eval_totalmoney = float(my_stock['StockNowMoney'])
                    stock_revenue_rate = float(my_stock['StockRevenueRate'])
                    stock_revenue_money = float(my_stock['StockRevenueMoney'])

                    break
                    

            #í˜„ì¬ê°€
            CurrentPrice = KisUS.GetCurrentPrice(stock_code)

                
            #ì¢…ëª© ë°ì´í„°
            PickStockInfo = None

            #ì €ì¥ëœ ì¢…ëª© ë°ì´í„°ë¥¼ ì°¾ëŠ”ë‹¤
            for StockInfo in InfinityUpgradeDataList:
                if StockInfo['StockCode'] == stock_code:
                    PickStockInfo = StockInfo
                    break

            #PickStockInfo ì´ê²Œ ì—†ë‹¤ë©´ ë§¤ìˆ˜ë˜ì§€ ì•Šì€ ì²˜ìŒ ìƒíƒœì´ê±°ë‚˜ ì´ì „ì— ì†ìœ¼ë¡œ ë§¤ìˆ˜í•œ ì¢…ëª©ì¸ë° í•´ë‹¹ ë´‡ìœ¼ë¡œ ëŒë¦¬ê³ ì í•  ë•Œ!
            if PickStockInfo == None:
                #ì”ê³ ê°€ ì—†ë‹¤ ì¦‰ ì²˜ìŒì´ë‹¤!!!
                if stock_amt == 0:

                    if stock_code == 'TQQQ' or stock_code == 'SOXL':

                        InfinityDataDict = dict()
                        
                        InfinityDataDict['StockCode'] = stock_code #ì¢…ëª© ì½”ë“œ
                        InfinityDataDict['MaxRound'] = 40 #ë§¥ìŠ¤ íšŒì°¨!
                        InfinityDataDict['Round'] = 0    #í˜„ì¬ íšŒì°¨
                        InfinityDataDict['IsReady'] = 'Y' #í•˜ë£¨ì— í•œë²ˆ ì²´í¬í•˜ê³  ë§¤ìˆ˜ë“±ì˜ ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•œ í”Œë˜ê·¸
                        InfinityDataDict['StMoney'] = StockMoney / InfinityDataDict['MaxRound']

                        InfinityUpgradeDataList.append(InfinityDataDict) #ë°ì´í„°ë¥¼ ì¶”ê°€ í•œë‹¤!

                    else: #ì¸ë²„ìŠ¤ SQQQ SOXSì˜ ê²½ìš°,,

                        InfinityDataDict = dict()
                        
                        InfinityDataDict['StockCode'] = stock_code #ì¢…ëª© ì½”ë“œ
                        InfinityDataDict['MaxRound'] = 1 #ë§¥ìŠ¤ íšŒì°¨!
                        InfinityDataDict['Round'] = 0     #í˜„ì¬ íšŒì°¨
                        InfinityDataDict['IsReady'] = 'Y' #í•˜ë£¨ì— í•œë²ˆ ì²´í¬í•˜ê³  ë§¤ìˆ˜ë“±ì˜ ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•œ í”Œë˜ê·¸
                        InfinityDataDict['StMoney'] = StockMoney

                        InfinityUpgradeDataList.append(InfinityDataDict) #ë°ì´í„°ë¥¼ ì¶”ê°€ í•œë‹¤!


                    msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 ì²« ì‹œì‘!!!!"
                    print(msg) 
                    line_alert.SendMessage(msg) 
                    
                #ë°ì´í„°ê°€ ì—†ëŠ”ë° ì”ê³ ê°€ ìˆë‹¤? ì´ë¯¸ ì´ ë´‡ìœ¼ë¡œ íŠ¸ë ˆì´ë”© í•˜ê¸°ì „ì— ë§¤ìˆ˜ëœ ì¢…ëª©!
                else:
                    print("Exist")

                    if stock_code == 'TQQQ' or stock_code == 'SOXL':


                        #ìº”ë“¤ ë°ì´í„°ë¥¼ ì½ëŠ”ë‹¤ ë¶„í•  ìˆ˜ë¥¼ ì •í•˜ê¸° ìœ„í•´!!!
                        df = Common.GetOhlcv("US",stock_code, 1000)

                        Ma210_before = Common.GetMA(df,210,-2)
                        Ma100_before = Common.GetMA(df,100,-2)
                        Ma60_before = Common.GetMA(df,60,-2)
                        Ma20_before = Common.GetMA(df,20,-2)
                    
                        MaxRound = 40

                        if Ma210_before > df['close'].iloc[-2]: #210ì¼ì„  ì•„ë˜ì— ìˆì„ ë• 35ë¶„í• 
                            MaxRound = 35
                            
                        else: # 210ì¼ì„  ìœ„ì— ìˆì„ ë• 

                            
                            st_num = 55
                            
                            if stock_code == 'TQQQ':
                                st_num = 54
                                
                                    
                            MaxRound = st_num
                        
                
                            if Ma100_before <= df['close'].iloc[-2]:
                                MaxRound -= 15


                            if Ma60_before <= df['close'].iloc[-2]:
                                MaxRound -= 8


                            if Ma20_before <= df['close'].iloc[-2]:
                                MaxRound -= 7     


                            if MaxRound == st_num:
                                MaxRound = 35    



                        InfinityDataDict = dict()
                        
                        InfinityDataDict['StockCode'] = stock_code #ì¢…ëª© ì½”ë“œ
                        InfinityDataDict['MaxRound'] = MaxRound #ë§¥ìŠ¤ íšŒì°¨!
                        
                        #ë¶„í• ëœ íˆ¬ìê¸ˆ!
                        StMoney = StockMoney / InfinityDataDict['MaxRound']
                        InfinityDataDict['Round'] = int(stock_eval_totalmoney / StMoney)    #í˜„ì¬ íšŒì°¨ - ë§¤ìˆ˜ëœ ê¸ˆì•¡ì„ ë¶„í• ëœ ë‹¨ìœ„ ê¸ˆì•¡ìœ¼ë¡œ ë‚˜ëˆ„ë©´ íšŒì°¨ê°€ ë‚˜ì˜¨ë‹¤!
                        InfinityDataDict['IsReady'] = 'Y' #í•˜ë£¨ì— í•œë²ˆ ì²´í¬í•˜ê³  ë§¤ìˆ˜ë“±ì˜ ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•œ í”Œë˜ê·¸

                        InfinityDataDict['StMoney'] = StMoney


                        InfinityUpgradeDataList.append(InfinityDataDict) #ë°ì´í„°ë¥¼ ì¶”ê°€ í•œë‹¤!

                    else: #ì¸ë²„ìŠ¤ SQQQ SOXSì˜ ê²½ìš°,,

                        InfinityDataDict = dict()
                        
                        InfinityDataDict['StockCode'] = stock_code #ì¢…ëª© ì½”ë“œ
                        InfinityDataDict['MaxRound'] = 1 #ë§¥ìŠ¤ íšŒì°¨!
                        InfinityDataDict['Round'] = 1    #í˜„ì¬ íšŒì°¨ 
                        InfinityDataDict['IsReady'] = 'Y' #í•˜ë£¨ì— í•œë²ˆ ì²´í¬í•˜ê³  ë§¤ìˆ˜ë“±ì˜ ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•œ í”Œë˜ê·¸

                        InfinityDataDict['StMoney'] = StMoney

                        InfinityUpgradeDataList.append(InfinityDataDict) #ë°ì´í„°ë¥¼ ì¶”ê°€ í•œë‹¤!


                    msg = stock_code + " ê¸°ì¡´ì— ë§¤ìˆ˜í•œ ì¢…ëª©ì„ ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2ìœ¼ë¡œ ë³€ê²½í•´ì„œ íŠ¸ë ˆì´ë”© ì²« ì‹œì‘!!!! " + str(InfinityDataDict['Round']) + "íšŒì°¨ë¡œ ì„¸íŒ… ì™„ë£Œ!"
                    print(msg) 
                    line_alert.SendMessage(msg) 

                #íŒŒì¼ì— ì €ì¥
                with open(bot_file_path, 'w') as outfile:
                    json.dump(InfinityUpgradeDataList, outfile)
                    

            #ì´ì œ ë°ì´í„°(InfinityUpgradeDataList)ëŠ” í™•ì‹¤íˆ ìˆì„ í…Œë‹ˆ ë³¸ê²©ì ìœ¼ë¡œ íŠ¸ë ˆì´ë”©ì„ í•©ë‹ˆë‹¤!
            for StockInfo in InfinityUpgradeDataList:

                if StockInfo['StockCode'] == stock_code:

                    if StockInfo.get('StMoney') == None:

                        msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 ë¶„í• ê¸ˆ ì²« ì„¸íŒ…!"
                        print(msg) 
                        line_alert.SendMessage(msg) 

                        if stock_code == 'TQQQ' or stock_code == 'SOXL':
                            StockInfo['StMoney'] = StockMoney / StockInfo['MaxRound']
                        else:
                            StockInfo['StMoney'] = StockMoney
                            



                    #ì–´ë–¤ ì´ìœ ì—ì„œ ë§¤ìˆ˜ ì‹¤íŒ¨í–ˆê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì¢…ëª© ë§¤ë„í•œ ê²½ìš° ë³´ìœ  ìˆ˜ëŸ‰ì´ 0ì¼í…ë° ë§Œì•½ ê·¸ë ‡ë‹¤ë©´ ë´‡ì—ì„œë„ 0ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³€ê²½í•´ì¤€ë‹¤!
                    if stock_amt == 0 and StockInfo['Round'] > 0 :
                        StockInfo['Round'] = 0

                        msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 " + str(StockInfo['Round']) + "íšŒì°¨ ë§¤ìˆ˜ ë˜ì—ˆë‹¤ê³  ë˜ì–´ìˆì§€ë§Œ ë§¤ìˆ˜ìˆ˜ëŸ‰ì´ 1ê°œë„ ì—†ëŠ” ê²ƒìœ¼ë¡œ íŒŒì•…!!! ë§¤ìˆ˜ì‹œ ë¡œê·¸ í™•ì¸ í•„ìš”! ë´‡ì—ì„œëŠ” ë§¤ìˆ˜ ì•ˆë˜ì—ˆë‹¤ê³  ì…‹!"
                        print(msg) 
                        line_alert.SendMessage(msg) 

            

                    #ë§¤ìˆ˜ëŠ” ì¥ì´ ì—´ë ¸ì„ ë•Œ 1ë²ˆë§Œ í•´ì•¼ ë˜ë‹ˆê¹! ì•ˆì˜ ë¡œì§ì„ ë‹¤ ìˆ˜í–‰í•˜ë©´ Nìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤! 
                    if StockInfo['IsReady'] == 'Y' :


                        #ìº”ë“¤ ë°ì´í„°ë¥¼ ì½ëŠ”ë‹¤
                        df = Common.GetOhlcv("US",stock_code, 1000)

                        #5ì¼ ì´í‰ì„ 
                        Ma5_before2 = Common.GetMA(df,5,-3)
                        Ma5_before = Common.GetMA(df,5,-2)
                        Ma5 = Common.GetMA(df,5,-1)

                        print("MA5 ", Ma5_before, "-> ",Ma5)

                        #210ì¼ ì´í‰ì„ 
                        Ma210_before2 = Common.GetMA(df,210,-3)
                        Ma210_before = Common.GetMA(df,210,-2)
                        Ma210 = Common.GetMA(df,210,-1)

                        print("MA210 ",Ma210)

                        
                        #RSI14
                        Rsi14= Common.GetRSI(df,14,-2)


                        Ma12_before = Common.GetMA(df,12,-2)
                        
                        
                        Ma100_before = Common.GetMA(df,100,-2)
                        Ma60_before2 = Common.GetMA(df,60,-3)
                        Ma60_before = Common.GetMA(df,60,-2)
                        
                        Ma20_before2 = Common.GetMA(df,20,-3)
                        Ma20_before = Common.GetMA(df,20,-2)
                        
                        
                        #3ì¼ ì´í‰ì„ 
                        Ma3_before2 = Common.GetMA(df,3,-3)
                        Ma3_before = Common.GetMA(df,3,-2)
                        
                    
                                    
                        Disparity5 = (df['close'].iloc[-2]/Common.GetMA(df,5,-2))*100.0 #ì „ì¼ ì¢…ê°€ ê¸°ì¤€ 5ì„  ì´ê²©ë„



                        msg = stock_code + " ì˜ ì–´ì œ ì¢…ê°€ " + str(df['close'].iloc[-2]) + " ì–´ì œ ì‹œê°€ : " + str(df['open'].iloc[-2]) + " " + str(df.index[-1])
                        print(msg) 
                        line_alert.SendMessage(msg) 
        


                        msg = stock_code + " ì˜ ì˜¤ëŠ˜ ì¢…ê°€(í˜„ì¬ê°€) " + str(df['close'].iloc[-1]) + " ì˜¤ëŠ˜ ì‹œê°€ : " + str(df['open'].iloc[-1]) + " " + str(df.index[-1])
                        print(msg) 
                        line_alert.SendMessage(msg) 

                                
                        #ë ˆë²„ë¦¬ì§€ì˜ ê²½ìš°!
                        if stock_code == 'TQQQ' or stock_code == 'SOXL':

                            

                            #1íšŒì°¨ ì´ìƒ ë§¤ìˆ˜ëœ ìƒí™©ì´ë¼ë©´ ìµì ˆ ì¡°ê±´ì„ ì²´í¬í•´ì„œ ìµì ˆ ì²˜ë¦¬ í•´ì•¼ í•œë‹¤!
                            if StockInfo['Round'] > 0 :
                                


                                #ëª©í‘œ ìˆ˜ìµë¥ ì„ êµ¬í•œë‹¤! 
                                TargetRate = 10.0  / 100.0

                                FinalRate = TargetRate 

                                #ìˆ˜ìµí™”í•  ê°€ê²©ì„ êµ¬í•œë‹¤!
                                RevenuePrice = stock_avg_price * (1.0 + FinalRate) 
                                
                                if CurrentPrice >= RevenuePrice or StockInfo['Round'] >= StockInfo['MaxRound']:

                                    
                                    st_disparity = 102
                                    
                                    if stock_code == 'TQQQ':
                                        st_disparity = 103


                                    #ëª©í‘œí•œ ìˆ˜ìµê°€ê²©ë³´ë‹¤ í˜„ì¬ê°€ê°€ ë†’ë‹¤ë©´ ìµì ˆì²˜ë¦¬í•  ìˆœê°„ì´ë‹¤!
                                    if CurrentPrice >= RevenuePrice and Disparity5 > st_disparity:
                                        
                
                                        #í˜„ì¬ê°€ë³´ë‹¤ ì•„ë˜ì— ë§¤ë„ ì£¼ë¬¸ì„ ë„£ìŒìœ¼ë¡œì¨ ì‹œì¥ê°€ë¡œ ë§¤ë„íš¨ê³¼!
                                        pprint.pprint(KisUS.MakeSellLimitOrder(stock_code,stock_amt,CurrentPrice*0.99))


                                        msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 ëª¨ë‘ íŒ”ì•„ì„œ ìˆ˜ìµí™•ì •!!!!  [" + str(stock_revenue_money) + "] ìˆ˜ìµ ì¡°ìœ¼ë‹¤! (í˜„ì¬ [" + str(StockInfo['Round']) + "] ë¼ìš´ë“œê¹Œì§€ ì§„í–‰ë˜ì—ˆê³  ëª¨ë“  ìˆ˜ëŸ‰ ë§¤ë„ ì²˜ë¦¬! )"
                                        print(msg) 
                                        line_alert.SendMessage(msg) 

                                        #ì „ëŸ‰ ë§¤ë„ ëª¨ë‘ ì´ˆê¸°í™”! 
                                        StockInfo['Round'] = 0


                                        #íŒŒì¼ì— ì €ì¥
                                        with open(bot_file_path, 'w') as outfile:
                                            json.dump(InfinityUpgradeDataList, outfile)
                                            
                                            
                                    else:
                                        
                                        
                                        if StockInfo['Round'] >= StockInfo['MaxRound']: #ì¿¼í„° ì†ì ˆ ë“¤ì–´ê°„ë‹¤!
                                            
                                            CutR = 8.0

                                            if Ma60_before2 > Ma60_before and Ma20_before2 > Ma20_before:
                                                CutR = 6.0


                                            StockInfo['Round'] -= int(StockInfo['Round']/CutR)
                                            CutAmt = int(stock_amt / CutR)

                                            pprint.pprint(KisUS.MakeSellLimitOrder(stock_code,CutAmt,CurrentPrice*0.99))


                                            msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 ì¼ë¶€ ì†ì ˆ!!!!  [" + str(stock_revenue_money/CutR) + "] ì†ìµ í™•ì •! (í˜„ì¬ [" + str(StockInfo['Round']) + "] ë¼ìš´ë“œë¡œ ì…‹!)"
                                            print(msg) 
                                            line_alert.SendMessage(msg) 

                                
                                            StockInfo['StMoney'] = StockMoney / StockInfo['MaxRound']


                                            #íŒŒì¼ì— ì €ì¥
                                            with open(bot_file_path, 'w') as outfile:
                                                json.dump(InfinityUpgradeDataList, outfile)
                                                
                                                
                                else:
                                    

                                    if StockInfo['Round'] < StockInfo['MaxRound']:
                                        
                                        IsBuyGo = False
                                        
                            
                                        if Ma100_before > df['close'].iloc[-2]: #ì–´ì œ ì¢…ê°€ê°€ 100ì¼ì„ ë³´ë‹¤ ì‘ì€ í•˜ë½ì¥!

                                            if Ma3_before2 < Ma3_before: #ì „ì¼ê¹Œì§€ 3ì¼ì„ ì´ ì¦ê°€í–ˆë‹¤ë©´ ê·¸ë•Œë§Œ ë§¤ìˆ˜!!
                                                IsBuyGo = True

                                        else: #210ì¼ì„  ìœ„ì— ìˆëŠ” ìƒìŠ¹ì¥ì—” ê¸°ì¡´ ì²˜ëŸ¼ ë§¤ì¼ ë§¤ìˆ˜!
                                            
                                            IsBuyGo = True
                    

                                        if stock_code == 'SOXL':
                                            if Ma3_before2 > Ma3_before and Ma5_before > df['close'].iloc[-2] and Ma3_before > df['close'].iloc[-2]  and df['low'].iloc[-3] > df['low'].iloc[-2]  and df['high'].iloc[-3] > df['high'].iloc[-2]:
                                                IsBuyGo = False


                                        if Rsi14 >= 80: #RSI 80ì´ìƒì˜ ê³¼ë§¤ë„ êµ¬ê°„ì—ì„  íšŒì°¨ ë§¤ìˆ˜ ì•ˆí•¨!!
                                            IsBuyGo = False


                                        if stock_code == 'SOXL':
                                                
                                            if  (Disparity5 > 110)  :

                                                IsBuyGo = False


                                        if Ma3_before2 > Ma3_before and Ma20_before2 > Ma20_before and Ma60_before2 > Ma60_before and Ma5_before > df['close'].iloc[-2]  and Ma20_before > df['close'].iloc[-2] and  Ma60_before > df['close'].iloc[-2] and  Ma210_before > df['close'].iloc[-2]:
                                            IsBuyGo = False                         

                                
                                        st_disparity = 93.5
                                        
                                        if stock_code == 'SOXL':
                                            st_disparity = 102.5
                                            
                            
                                        #210ì¼ì„  ìœ„ì— ìˆë‹¤ê°€ ì•„ë˜ë¡œ ì¢…ê°€ê°€ ë–¨ì–´ì§€ë©´... (ì¶”ê°€ì ìœ¼ë¡œ ì´ê²©ë„ ì²´í¬)
                                        if (Ma210_before2 < df['close'].iloc[-3] and Ma210_before > df['close'].iloc[-2]) and Disparity5 < st_disparity:
                                        

                                            #í˜„ì¬ê°€ë³´ë‹¤ ì•„ë˜ì— ë§¤ë„ ì£¼ë¬¸ì„ ë„£ìŒìœ¼ë¡œì¨ ì‹œì¥ê°€ë¡œ ë§¤ë„íš¨ê³¼!
                                            pprint.pprint(KisUS.MakeSellLimitOrder(stock_code,stock_amt,CurrentPrice*0.99))


                                            msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 í•˜ë½ì¥ ì§„ì…!!!!!  [" + str(stock_revenue_money) + "] ì†ìµ í™•ì •!! (í˜„ì¬ [" + str(StockInfo['Round']) + "] ë¼ìš´ë“œê¹Œì§€ ì§„í–‰ë˜ì—ˆê³  ëª¨ë“  ìˆ˜ëŸ‰ ë§¤ë„ ì²˜ë¦¬! )"
                                            print(msg) 
                                            line_alert.SendMessage(msg) 

                                            #ì „ëŸ‰ ë§¤ë„ ëª¨ë‘ ì´ˆê¸°í™”! 
                                            StockInfo['Round'] = 0


                                            #íŒŒì¼ì— ì €ì¥
                                            with open(bot_file_path, 'w') as outfile:
                                                json.dump(InfinityUpgradeDataList, outfile)
                                                
                                            IsBuyGo = False
                                                
                            

                                        #í•œ íšŒì°¨ ë§¤ìˆ˜ í•œë‹¤!!
                                        if IsBuyGo == True:

                                            StockInfo['Round'] += 1 #ë¼ìš´ë“œ ì¦ê°€!

        


                                            time.sleep(10.0)

                                            
                                            BuyAmt = int(StockInfo['StMoney'] / CurrentPrice)
                                            
                                            #1ì£¼ë³´ë‹¤ ì ë‹¤ë©´ íˆ¬ìê¸ˆì´ë‚˜ íˆ¬ìë¹„ì¤‘ì´ ì‘ì€ ìƒí™©ì¸ë° ì¼ë‹¨ 1ì£¼ëŠ” ë§¤ìˆ˜í•˜ê²Œë” ì²˜ë¦¬ í•˜ì!
                                            if BuyAmt < 1:
                                                BuyAmt = 1

                                            #ì‹œì¥ê°€ ì£¼ë¬¸ì„ ë„£ëŠ”ë‹¤!
                                            #í˜„ì¬ê°€ë³´ë‹¤ ìœ„ì— ë§¤ìˆ˜ ì£¼ë¬¸ì„ ë„£ìŒìœ¼ë¡œì¨ ì‹œì¥ê°€ë¡œ ë§¤ìˆ˜!
                                            pprint.pprint(KisUS.MakeBuyLimitOrder(stock_code,BuyAmt,CurrentPrice*1.01))


                                            msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 " + str(StockInfo['Round']) + "íšŒì°¨ ë§¤ìˆ˜ ì™„ë£Œ!"
                                            print(msg) 
                                            line_alert.SendMessage(msg) 
                                        else:

                                            msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 " + str(StockInfo['Round']) + "íšŒì°¨ íˆ¬ìì¤‘.. ì˜¤ëŠ˜ì€ ë§¤ìˆ˜í•˜ì§€ ì•ŠìŒ"
                                            print(msg) 
                                            line_alert.SendMessage(msg) 
                        
                        else: #ì¸ë²„ìŠ¤ì˜ ê²½ìš°
                            
                            #1íšŒì°¨ ì´ìƒ ë§¤ìˆ˜ëœ ìƒí™©ì´ë¼ë©´ ì¸ë²„ìŠ¤ì˜ ê²½ìš° ì¡°ê±´ ì²´í¬í•´ì„œ ë§¤ë„í•œë‹¤.
                            if StockInfo['Round'] > 0 :

                                IsSellGo = False
                                
                                if  (Disparity5 > 102 or Disparity5 < 98):

                                    IsSellGo = True
                                    
                                if IsSellGo == True:

                                    #í˜„ì¬ê°€ë³´ë‹¤ ì•„ë˜ì— ë§¤ë„ ì£¼ë¬¸ì„ ë„£ìŒìœ¼ë¡œì¨ ì‹œì¥ê°€ë¡œ ë§¤ë„íš¨ê³¼!
                                    pprint.pprint(KisUS.MakeSellLimitOrder(stock_code,stock_amt,CurrentPrice*0.99))


                                    msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 ëª¨ë‘ ì •ë¦¬!!!!!  [" + str(stock_revenue_money) + "] ì†ìµ í™•ì •!! (í˜„ì¬ [" + str(StockInfo['Round']) + "] ë¼ìš´ë“œê¹Œì§€ ì§„í–‰ë˜ì—ˆê³  ëª¨ë“  ìˆ˜ëŸ‰ ë§¤ë„ ì²˜ë¦¬! )"
                                    print(msg) 
                                    line_alert.SendMessage(msg) 

                                    #ì „ëŸ‰ ë§¤ë„ ëª¨ë‘ ì´ˆê¸°í™”! 
                                    StockInfo['Round'] = 0


                                    #íŒŒì¼ì— ì €ì¥
                                    with open(bot_file_path, 'w') as outfile:
                                        json.dump(InfinityUpgradeDataList, outfile)
            

                        #ë ˆë²„ë¦¬ì§€ì˜ ê²½ìš°!
                        if stock_code == 'TQQQ' or stock_code == 'SOXL':

                            
                            IsGoNext = False

                            if StockInfo['Round'] == 0 and (Ma5_before < df['close'].iloc[-2] or Ma3_before2 < Ma3_before): #ì „ì¼ ì¢…ê°€ê°€ 5ì¼ì„  ìœ„ì— ìˆì„ ë•Œë§Œ 

                                IsGoNext = True


                            if IsGoNext == True:
                                
                                print("IN!!!")

                                if Ma210_before > df['close'].iloc[-2]: #210ì¼ì„  ì•„ë˜ì— ìˆì„ ë• 35ë¶„í• 
                                    StockInfo['MaxRound'] = 35
                                    
                                else: # 210ì¼ì„  ìœ„ì— ìˆì„ ë• 

                                    
                                    st_num = 55
                                    
                                    if stock_code == 'TQQQ':
                                        st_num = 54
                                        
                                            
                                    StockInfo['MaxRound'] = st_num
                                
                    
                                    if Ma100_before <= df['close'].iloc[-2]:
                                        StockInfo['MaxRound'] -= 15


                                    if Ma60_before <= df['close'].iloc[-2]:
                                        StockInfo['MaxRound'] -= 8


                                    if Ma20_before <= df['close'].iloc[-2]:
                                        StockInfo['MaxRound'] -= 7     


                                    if StockInfo['MaxRound'] == st_num:
                                        StockInfo['MaxRound'] = 35    

                        
                                
                                StockInfo['Round'] += 1 #ë¼ìš´ë“œ ì¦ê°€!


                                StockInfo['StMoney'] = StockMoney / StockInfo['MaxRound']


                                BuyAmt = int(StockInfo['StMoney'] / CurrentPrice)
                                
                                #1ì£¼ë³´ë‹¤ ì ë‹¤ë©´ íˆ¬ìê¸ˆì´ë‚˜ íˆ¬ìë¹„ì¤‘ì´ ì‘ì€ ìƒí™©ì¸ë° ì¼ë‹¨ 1ì£¼ëŠ” ë§¤ìˆ˜í•˜ê²Œë” ì²˜ë¦¬ í•˜ì!
                                if BuyAmt < 1:
                                    BuyAmt = 1

                                time.sleep(10.0)

                                #ì‹œì¥ê°€ ì£¼ë¬¸ì„ ë„£ëŠ”ë‹¤!
                                #í˜„ì¬ê°€ë³´ë‹¤ ìœ„ì— ë§¤ìˆ˜ ì£¼ë¬¸ì„ ë„£ìŒìœ¼ë¡œì¨ ì‹œì¥ê°€ë¡œ ë§¤ìˆ˜!
                                data = KisUS.MakeBuyLimitOrder(stock_code,BuyAmt,CurrentPrice*1.01)


                                msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 " + str(StockInfo['Round']) + "íšŒì°¨ ë§¤ìˆ˜ ì™„ë£Œ!\n" + str(data)
                                print(msg) 
                                line_alert.SendMessage(msg) 

                        #ì¸ë²„ìŠ¤ì˜ ê²½ìš°        
                        else:


                            IsBuyGo = False
                


                            if Ma60_before < df['close'].iloc[-2] or Ma20_before2 < Ma20_before:

                                if (df['low'].iloc[-3] < df['low'].iloc[-2]) and df['open'].iloc[-2] < df['close'].iloc[-2] :


                                    if Ma12_before > df['close'].iloc[-2] and Ma3_before< df['close'].iloc[-2]:
                                        IsBuyGo = True


                                    if Ma20_before > df['close'].iloc[-2]:

                                        if df['open'].iloc[-3] > df['close'].iloc[-3]:
                                            IsBuyGo = True


                                    if  (Disparity5 > 102 or Disparity5 < 98) :
                                        IsBuyGo = False


                                    if stock_code == 'SOXS':
                                        if df['volume'].iloc[-3] > df['volume'].iloc[-2]:
                                            IsBuyGo = False


                            if IsBuyGo == True:    


                                StockInfo['Round'] = 1 #ì¸ë²„ìŠ¤ëŠ” ë¬´ì¡°ê±´ 1ì´ë‹¤!

                
                                #ë¶„í• ëœ íˆ¬ìê¸ˆ!
                                StMoney = StockMoney


                                BuyAmt = int(StMoney / CurrentPrice)
                                
                                #1ì£¼ë³´ë‹¤ ì ë‹¤ë©´ íˆ¬ìê¸ˆì´ë‚˜ íˆ¬ìë¹„ì¤‘ì´ ì‘ì€ ìƒí™©ì¸ë° ì¼ë‹¨ 1ì£¼ëŠ” ë§¤ìˆ˜í•˜ê²Œë” ì²˜ë¦¬ í•˜ì!
                                if BuyAmt < 1:
                                    BuyAmt = 1

                                #ì‹œì¥ê°€ ì£¼ë¬¸ì„ ë„£ëŠ”ë‹¤!
                                #í˜„ì¬ê°€ë³´ë‹¤ ìœ„ì— ë§¤ìˆ˜ ì£¼ë¬¸ì„ ë„£ìŒìœ¼ë¡œì¨ ì‹œì¥ê°€ë¡œ ë§¤ìˆ˜!
                                data = KisUS.MakeBuyLimitOrder(stock_code,BuyAmt,CurrentPrice*1.01)

                                msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 " + str(StMoney) + "ë§Œí¼ ë§¤ìˆ˜ " + str(BuyAmt) +"ê°œ.. í˜„ì¬ê°€ " + str(CurrentPrice)
                                print(msg) 
                                line_alert.SendMessage(msg) 
                                

                                time.sleep(10.0)

                                msg = stock_code + " ì–‘ë°©í–¥3ë°°ì „ëµë´‡v2 " + str(StockInfo['Round']) + "íšŒì°¨ ë§¤ìˆ˜ ì™„ë£Œ! \n" + str(data)
                                print(msg) 
                                line_alert.SendMessage(msg) 

                                
                        #ìœ„ ë¡œì§ ì™„ë£Œí•˜ë©´ Nìœ¼ë¡œ ë°”ê¿”ì„œ ì˜¤ëŠ˜ ë§¤ìˆ˜ëŠ” ì•ˆë˜ê²Œ ì²˜ë¦¬!
                        StockInfo['IsReady'] = 'N' 

                    #íŒŒì¼ì— ì €ì¥
                    with open(bot_file_path, 'w') as outfile:
                        json.dump(InfinityUpgradeDataList, outfile) 
                        
                    break

    else:

            
        #ì¥ì´ ëë‚˜ê³  ë‹¤ìŒë‚  ë‹¤ì‹œ ë§¤ìˆ˜ì‹œë„ í• ìˆ˜ ìˆê²Œ Yë¡œ ë°”ê¿”ì¤ë‹ˆë‹¹!
        for StockInfo in InfinityUpgradeDataList:
            StockInfo['IsReady'] = 'Y'


        #íŒŒì¼ì— ì €ì¥
        with open(bot_file_path, 'w') as outfile:
            json.dump(InfinityUpgradeDataList, outfile)
            
            
    pprint.pprint(InfinityUpgradeDataList)

else:
    print("ì½”ë“œ ë§¨ ì²« ë¶€ë¶„ì— ENABLE_ORDER_EXECUTION ê°’ì„ Trueë¡œ ë³€ê²½í•´ì•¼ ë§¤ìˆ˜ë§¤ë„ê°€ ì§„í–‰ë©ë‹ˆë‹¤!")