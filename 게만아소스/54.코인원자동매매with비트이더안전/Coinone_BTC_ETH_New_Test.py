#-*-coding:utf-8 -*-
'''

$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

í•´ë‹¹ ì»¨í…ì¸ ëŠ” ì œê°€ ì§ì ‘ íˆ¬ì í•˜ê¸° ìœ„í•´ ì´ ì „ëµì„ ì¶”ê°€ ê°œì„ í•´ì„œ ë” ì¢‹ì€ ì„±ê³¼ë¥¼ ë³´ì—¬ì£¼ëŠ” ê°œì¸ ì „ëµì´ ì¡´ì¬í•©ë‹ˆë‹¤.  

ê²Œë§Œì•„ ì¶”ê°€ ê°œì„  ê°œì¸ ì „ëµë“¤..
https://blog.naver.com/zacra/223196497504

ê´€ì‹¬ ìˆìœ¼ì‹  ë¶„ì€ ìœ„ í¬ìŠ¤íŒ…ì„ ì°¸ê³ í•˜ì„¸ìš”!

$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$


$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

ë°±í…ŒìŠ¤íŒ…ì€ ë‚´PCì—ì„œ í•´ì•¼ ì„œë²„ ìì›ì„ ì•„ë¼ê³  íˆ¬ì ì„±ê³¼ ê·¸ë˜í”„ë„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!
ì´ í¬ìŠ¤íŒ…ì„ ì •ë…í•˜ì‹œê³  ë‹¤ì–‘í•œ ê¸°ê°„ìœ¼ë¡œ ë°±í…ŒìŠ¤íŒ… í•´ë³´ì„¸ìš”!!!
https://blog.naver.com/zacra/223180500307

$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$



ê´€ë ¨ í¬ìŠ¤íŒ… 
https://blog.naver.com/zacra/223508324003

ìµœê·¼ ë§ˆì§€ë§‰ ìˆ˜ì • í¬ìŠ¤íŒ…
https://blog.naver.com/zacra/223805709477

ìœ„ í¬ìŠ¤íŒ…ì„ ê¼­ ì°¸ê³ í•˜ì„¸ìš”!!!

ğŸ“Œ ê²Œë§Œì•„ì˜ ëª¨ë“  ì½”ë“œëŠ” íŠ¹ì • ì¢…ëª© ì¶”ì²œì´ë‚˜ íˆ¬ì ê¶Œìœ ë¥¼ ìœ„í•œ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤.  
ì œì‘ìì˜ ê°œì¸ì ì¸ ê²¬í•´ë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬ì„±ëœ êµìœ¡ìš© ì˜ˆì‹œ ì½”ë“œì´ë©°, ìˆ˜ìµì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
ì‹¤ì œ íˆ¬ì íŒë‹¨ ë° ì‹¤í–‰ì€ ì „ì ìœ¼ë¡œ ì‚¬ìš©ì ë³¸ì¸ì˜ ì±…ì„ì…ë‹ˆë‹¤.

ì£¼ì‹/ì½”ì¸ íŒŒì´ì¬ ë§¤ë§¤ FAQ
https://blog.naver.com/zacra/223203988739

FAQë¡œ í•´ê²° ì•ˆë˜ëŠ” ê¸°ìˆ ì ì¸ ë¬¸ì œëŠ” í´ë˜ìŠ¤101 ê°•ì˜ì˜ ëŒ“ê¸€ì´ë‚˜ ìœ„ í¬ìŠ¤íŒ…ì— ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì„¸ìš”.
íŒŒì´ì¬ ì½”ë”©ì— ëŒ€í•œ ë‹µë³€ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. í˜„í–‰ë²• ìƒ íˆ¬ì ê´€ë ¨ ì§ˆë¬¸ì€ ë‹µë³€ ë¶ˆê°€í•˜ë‹¤ëŠ” ì  ì•Œë ¤ë“œë ¤ìš”!


##############################################################
ì½”ì¸ì› ì•± -> í•˜ë‹¨ ë”ë³´ê¸° -> ì´ë²¤íŠ¸ ì½”ë“œ -> ë“±ë¡í•˜ê¸° -> ZABOBSTUDIO 
##############################################################


'''

import myCoinone

import pandas as pd
import pprint
import matplotlib.pyplot as plt




InvestTotalMoney = 1000000 #ê·¸ëƒ¥ 1ë°±ë§Œì›ìœ¼ë¡œ ë°•ì•„ì„œ í…ŒìŠ¤íŒ… í•´ë³´ê¸°!!!


######################################## 2. ì°¨ë“± ë¶„í•  íˆ¬ì ###################################################
#'''
InvestCoinList = list()

InvestDataDict = dict()
InvestDataDict['ticker'] = "BTC"
InvestDataDict['rate'] = 0.5
InvestCoinList.append(InvestDataDict)

InvestDataDict = dict()
InvestDataDict['ticker'] = "ETH"
InvestDataDict['rate'] = 0.5
InvestCoinList.append(InvestDataDict)




#'''
##########################################################################################################


ResultList = list()

######################################## 1. ê· ë“± ë¶„í•  íˆ¬ì ###########################################################
'''
for coin_ticker in InvestCoinList:    
    InvestMoney = InvestTotalMoney / len(InvestCoinList) #í…ŒìŠ¤íŠ¸ ì´ ê¸ˆì•¡ì„ ì¢…ëª© ìˆ˜ë¡œ ë‚˜ëˆ ì„œ ê° í• ë‹¹ íˆ¬ìê¸ˆì„ ê³„ì‚°í•œë‹¤!
'''
##########################################################################################################

######################################## 2. ì°¨ë“± ë¶„í•  íˆ¬ì ###################################################



TotalResultDict= dict()


    #'''
for coin_data in InvestCoinList:

    coin_ticker = coin_data['ticker']
    print("\n----coin_ticker: ", coin_ticker)

    InvestMoney = InvestTotalMoney * coin_data['rate'] #ì„¤ì •ëœ íˆ¬ìê¸ˆì— ë§ê²Œ íˆ¬ì!
    #'''
##########################################################################################################



    print(coin_ticker, " ì¢…ëª©ë‹¹ í• ë‹¹ íˆ¬ìê¸ˆ:", InvestMoney)


    RealInvestMoney = 0
    RemainInvestMoney = InvestMoney

    TotalBuyAmt = 0 #ë§¤ìˆ˜ ìˆ˜ëŸ‰
    TotalPureMoney = 0 #ë§¤ìˆ˜ ê¸ˆì•¡



    #ì¼ë´‰ ì •ë³´ë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤! 800
    #ì‚¬ì‹¤ ë¶„ë´‰ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í•´ë³´ì…”ë„ ë©ë‹ˆë‹¤. ì €ëŠ” ì¼ë´‰ìœ¼ë¡œ~^^
    df = myCoinone.GetOhlcv(coin_ticker,'1d',1620) 
   

    ########## RSI ì§€í‘œ êµ¬í•˜ëŠ” ë¡œì§! ##########
    period = 14

    delta = df["close"].diff()
    up, down = delta.copy(), delta.copy()
    up[up < 0] = 0
    down[down > 0] = 0
    _gain = up.ewm(com=(period - 1), min_periods=period).mean()
    _loss = down.abs().ewm(com=(period - 1), min_periods=period).mean()
    RS = _gain / _loss

    df['rsi'] = pd.Series(100 - (100 / (1 + RS)), name="RSI")

    ########################################
    df['rsi_ma'] = df['rsi'].rolling(10).mean()
    df['prev_close'] = df['close'].shift(1)
    df['change'] = (df['close']-df['prev_close'])/df['prev_close']
    

    ############# ì´ë™í‰ê· ì„ ! ###############
    #for ma in range(3,81):
    #    df[str(ma) + 'ma'] = df['close'].rolling(ma).mean()
        
    ma_dfs = []

    # ì´ë™ í‰ê·  ê³„ì‚°
    for ma in range(3, 81):
        ma_df = df['close'].rolling(ma).mean().rename(str(ma) + 'ma')
        ma_dfs.append(ma_df)

    # ì´ë™ í‰ê·  ë°ì´í„° í”„ë ˆì„ì„ í•˜ë‚˜ë¡œ ê²°í•©
    ma_df_combined = pd.concat(ma_dfs, axis=1)

    # ì›ë³¸ ë°ì´í„° í”„ë ˆì„ê³¼ ê²°í•©
    df = pd.concat([df, ma_df_combined], axis=1)


    ########################################
    
    
    
    df['value_ma'] = df['value'].rolling(window=10).mean().shift(1)


    df = df[:len(df)-1]

    df.dropna(inplace=True) #ë°ì´í„° ì—†ëŠ”ê±´ ë‚ ë¦°ë‹¤!
    pprint.pprint(df)


    IsBuy = False #ë§¤ìˆ˜ í–ˆëŠ”ì§€ ì—¬ë¶€

    TryCnt = 0      #ë§¤ë§¤íšŸìˆ˜
    SuccessCnt = 0   #ìµì ˆ ìˆ«ì
    FailCnt = 0     #ì†ì ˆ ìˆ«ì

    fee = 0.002 #ìˆ˜ìˆ˜ë£Œ+ì„¸ê¸ˆ+ìŠ¬ë¦¬í”¼ì§€ë¥¼ ë§¤ìˆ˜ë§¤ë„ë§ˆë‹¤ 0.2%ë¡œ ì„¸íŒ…!

    IsFirstDateSet = False
    FirstDateStr = ""
    FirstDateIndex = 0

   

    TotalMoneyList = list()

    AvgPrice = 0

    

    #######ì´í‰ì„  ì„¤ì • ########
    ma1 = 6  
    ma2 = 10 
    ma3 = 19


    BUY_PRICE = 0
    IsDolpaDay = False
    
    for i in range(len(df)):

        if FirstDateStr == "":
            FirstDateStr = df.iloc[i].name



        IsSellToday = False

        NowOpenPrice = df['open'].iloc[i]  
        PrevOpenPrice = df['open'].iloc[i-1]  
        PrevClosePrice = df['close'].iloc[i-1]

        
    
        if IsBuy == True:

            #íˆ¬ìì¤‘ì´ë©´ ë§¤ì¼ë§¤ì¼ ìˆ˜ìµë¥  ë°˜ì˜!


            IsSellGo = False

            SellPrice = NowOpenPrice
            
            #ì´ë”ë¦¬ì›€ì˜ ê²½ìš°
            if coin_ticker == 'ETH':

                #RSIì§€í‘œê°€ 70ì´ìƒì¸ ê³¼ë§¤ìˆ˜ êµ¬ê°„ì—ì„œ ë‹¨ê¸° ì´í‰ì„ ì„ ì•„ë˜ë¡œ ëš«ìœ¼ë©´ ëŒíŒŒë§¤ë„ ì²˜ë¦¬!!
                CutPrice = df[str(ma1)+'ma'].iloc[i-1]
                
                if  df['rsi'].iloc[i-1] >= 70 and df['low'].iloc[i] <= CutPrice and NowOpenPrice > CutPrice :
                    SellPrice = CutPrice
                    IsSellGo = True
                    IsDolpaCut = True

           

            #ë‹¨ ê·¸ ì „ë‚  ëŒíŒŒë¡œ ë§¤ë§¤í•œ ë‚ ì´ë¼ë©´ ë§¤ìˆ˜í•œ ê°€ê²©ëŒ€ë¹„ ìˆ˜ìµë¥ ì„ ë”í•´ì•¼ í•˜ë‹ˆê¹.
            if IsDolpaDay == True:
                RealInvestMoney = RealInvestMoney * (1.0 + ((SellPrice - BUY_PRICE) / BUY_PRICE))
                IsDolpaDay = False
            else:
                RealInvestMoney = RealInvestMoney * (1.0 + ((SellPrice - PrevOpenPrice) / PrevOpenPrice))


            InvestMoney = RealInvestMoney + RemainInvestMoney 

            Rate = 0
            RevenueRate = 0
            
            if AvgPrice > 0:
            
                #ì§„ì…(ë§¤ìˆ˜)ê°€ê²© ëŒ€ë¹„ ë³€ë™ë¥ 
                Rate = (SellPrice - AvgPrice) / AvgPrice

                RevenueRate = (Rate - fee)*100.0 #ìˆ˜ìµë¥  ê³„ì‚°


            #ì´ë”ë¦¬ì›€ì˜ ê²½ìš°
            if coin_ticker == 'ETH':

                #50ì¼ì„  ìœ„ì— ìˆëŠ” ìƒìŠ¹ì¥
                if  PrevClosePrice > df['50ma'].iloc[i-1]:
                
                    #5ì¼ì„ , 10ì¼ì„  ë‘˜ë‹¤ ë°‘ìœ¼ë¡œ ë‚´ë ¤ê°€ë©´ ë§¤ë„!!
                    if  PrevClosePrice < df[str(ma1)+'ma'].iloc[i-1] and PrevClosePrice < df[str(ma2)+'ma'].iloc[i-1]:
                        IsSellGo = True

                #50ì¼ì„  ì•„ë˜ìˆëŠ” í•˜ë½ì¥
                else:
                  
                    # 5ì¼ì„  ë°‘ìœ¼ë¡œ ë‚´ë ¤ê°€ê±°ë‚˜ ì „ì¼ ìº”ë“¤ ê¸°ì¤€ ê³ ê°€ë„ í•˜ë½í•˜ê³  ì €ê°€ë„ í•˜ë½í–ˆë‹¤ë©´ ë§¤ë„!
                    if  PrevClosePrice < df[str(ma1)+'ma'].iloc[i-1] or (df['high'].iloc[i-2] > df['high'].iloc[i-1] and df['low'].iloc[i-2] > df['low'].iloc[i-1]) :
                        IsSellGo = True

            #ë¹„íŠ¸ì½”ì¸ì˜ ê²½ìš°
            else:
                #ì „ì¼ ìº”ë“¤ ê¸°ì¤€ ê³ ê°€ë„ í•˜ë½í•˜ê³  ì €ê°€ë„ í•˜ë½í–ˆê±°ë‚˜ 2ì—°ì† ìŒë´‰ì´ê±°ë‚˜ ìˆ˜ìµë¥ ì´ 0ë³´ë‹¤ ì‘ì•„ì§€ë©´ ë§¤ë„!!
                if ((df['high'].iloc[i-2] > df['high'].iloc[i-1] and df['low'].iloc[i-2] > df['low'].iloc[i-1]) or (df['open'].iloc[i-1] > df['close'].iloc[i-1] and df['open'].iloc[i-2] > df['close'].iloc[i-2])  ) or RevenueRate < 0 :
                    IsSellGo = True

            
                if df['rsi_ma'].iloc[i-2] < df['rsi_ma'].iloc[i-1] and df['3ma'].iloc[i-2] < df['3ma'].iloc[i-1]:
                    IsSellGo = False



            #ë„ì§€ ìº”ë“¤ íŒ¨í„´ ì²´í¬
            prev_high_low_gap = abs(df['high'].iloc[i-2] - df['low'].iloc[i-2])
            prev_open_close_gap = abs(df['open'].iloc[i-2] - df['close'].iloc[i-2])

            #ìœ—ê¼¬ë¦¬ì™€ ì•„ë˜ê¼¬ë¦¬ ê¸¸ì´ ê³„ì‚°
            upper_tail = df['high'].iloc[i-1] - max(df['open'].iloc[i-1], df['close'].iloc[i-1])
            lower_tail = min(df['open'].iloc[i-1], df['close'].iloc[i-1]) - df['low'].iloc[i-1]


            #ì‹œê°€ì™€ ì¢…ê°€ì˜ ê°­ì´ ê³ ê°€ì™€ ì €ê°€ì˜ ê°­ì˜ 40% ì´í•˜ë©´ì„œ ìœ—ê¼¬ë¦¬ê°€ ë” ê¸¸ ê²½ìš°..
            if (prev_high_low_gap > 0 and (prev_open_close_gap / prev_high_low_gap) <= 0.4) and upper_tail > lower_tail:
                    
                #ì €ì „ì €ê°€ë³´ë‹¤ ì´ì „ì¢…ê°€ê°€ ë‚®ìœ¼ë©´ì„œ ìˆ˜ìµë¥ ì´ 0ë³´ë‹¤ ì‘ë‹¤ë©´..
                if df['low'].iloc[i-2] > df['close'].iloc[i-1] and RevenueRate < 0:
                    IsSellGo = True
                    
                    
            if IsSellGo == True :

                SellAmt = TotalBuyAmt

                InvestMoney = RemainInvestMoney + (RealInvestMoney * (1.0 - fee))  #ìˆ˜ìˆ˜ë£Œ ë° ì„¸ê¸ˆ, ìŠ¬ë¦¬í”¼ì§€ ë°˜ì˜!

                TotalBuyAmt = 0
                TotalPureMoney = 0

                RealInvestMoney = 0
                RemainInvestMoney = InvestMoney
                AvgPrice = 0


                print(coin_ticker ," ", df.iloc[i].name, " >>>>>>>ëª¨ë‘ ë§¤ë„!!:", SellAmt ,"ëˆ„ì ìˆ˜ëŸ‰:",TotalBuyAmt," í‰ë‹¨: ",round(AvgPrice,2),">>>>>>>> ë§¤ë„!  \níˆ¬ìê¸ˆ ìˆ˜ìµë¥ : ", round(RevenueRate,2) , "%", " ,ì¢…ëª© ì”ê³ :",round(RemainInvestMoney,2), "+",round(RealInvestMoney,2), "=",round(InvestMoney,2)  , " ë§¤ë„ê°€:", round(SellPrice,2),"\n\n")



                TryCnt += 1

                if RevenueRate > 0: #ìˆ˜ìµë¥ ì´ 0ë³´ë‹¤ í¬ë‹¤ë©´ ìµì ˆí•œ ì…ˆì´ë‹¤!
                    SuccessCnt += 1
                else:
                    FailCnt += 1



                InvestMoney = RealInvestMoney + RemainInvestMoney 

                IsBuy = False 
                IsSellToday = True


       
        if IsBuy == False and i > 2 and IsSellToday == False: 

            
            if IsFirstDateSet == False:
                FirstDateIndex = i-1
                IsFirstDateSet = True


            IsBuyGo = False
            
            InvestGoMoney = 0



            #ì´í‰ì„  ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ”ì§€
            IsMaDone = False
            

            if coin_ticker == 'ETH':

                #3ê°œì˜ ì´í‰ì„  ì¤‘ ê°€ì¥ ë†’ì€ ê°’ì„ êµ¬í•œë‹¤!
                DolPaSt = max(df[str(ma1)+'ma'].iloc[i-1],df[str(ma2)+'ma'].iloc[i-1],df[str(ma3)+'ma'].iloc[i-1])

                
                #ê°€ì¥ ë†’ì€ ì´í‰ì„ ì˜ ê°’ì´ ê°€ì¥ ê¸´ ê¸°ê°„ì˜ ì´í‰ì„ ì¼ë•Œ
                #ê·¸ ì „ì¼ ì´í‰ì„  ê°’ì„ í˜„ì¬ê°€ê°€ ë„˜ì—ˆë‹¤ë©´ ëŒíŒŒ ë§¤ìˆ˜ë¥¼ í•œë‹¤!!!
                if DolPaSt == df[str(ma3)+'ma'].iloc[i-1] and df['high'].iloc[i] >= DolPaSt and NowOpenPrice < DolPaSt:

                    #ë‹¨ RSIì§€í‘œê°€ ì¦ê°€! RSI 10ì¼ í‰ê· ì§€í‘œë„ ì¦ê°€í•  ë•Œ ëŒíŒŒë§¤ìˆ˜!
                    if  df['rsi'].iloc[i-2] < df['rsi'].iloc[i-1] and df['rsi_ma'].iloc[i-2] < df['rsi_ma'].iloc[i-1] :

                        #ê·¸ë ‡ë‹¤ë©´ ê·¸ ëŒíŒŒ ê°€ê²©ì— ë§¤ìˆ˜ë¥¼ í–ˆë‹¤ê³  ê°€ì •í•œë‹¤.
                        BUY_PRICE = DolPaSt
                        IsDolpaDay = True
                        IsMaDone = True
            

                #ê·¸ ë°–ì˜ ê²½ìš°
                else:
                    ##3ê°œì˜ ì´ë™í‰ê· ì„  ìœ„ì— ìˆê³  RSIì§€í‘œê°€ ì¦ê°€! RSI 10ì¼ í‰ê· ì§€í‘œë„ ì¦ê°€í•œë‹¤ë©´ ë§¤ìˆ˜!
                    if  PrevClosePrice > df[str(ma1)+'ma'].iloc[i-1] and PrevClosePrice > df[str(ma2)+'ma'].iloc[i-1]  and PrevClosePrice > df[str(ma3)+'ma'].iloc[i-1] and df['rsi'].iloc[i-2] < df['rsi'].iloc[i-1] and df['rsi_ma'].iloc[i-2] < df['rsi_ma'].iloc[i-1]:
                        BUY_PRICE = NowOpenPrice
                        IsDolpaDay = False
                        IsMaDone = True



                if IsMaDone == False:


                    DolpaRate = 0.7

                    if df[str(ma3)+'ma'].iloc[i-2] < PrevClosePrice:
                        DolpaRate = 0.6

                    if df[str(ma1)+'ma'].iloc[i-2] < df[str(ma1)+'ma'].iloc[i-1] and df[str(ma2)+'ma'].iloc[i-2] < df[str(ma2)+'ma'].iloc[i-1] and df[str(ma3)+'ma'].iloc[i-2] < df[str(ma3)+'ma'].iloc[i-1] and df[str(ma3)+'ma'].iloc[i-2] < df[str(ma2)+'ma'].iloc[i-1] < df[str(ma1)+'ma'].iloc[i-1]:
                        DolpaRate = 0.5


                    DolPaSt = NowOpenPrice + (( df['high'].iloc[i-1] - df['low'].iloc[i-1]) * DolpaRate)

                    if df['high'].iloc[i] >= DolPaSt and NowOpenPrice < DolPaSt and df['rsi_ma'].iloc[i-2] < df['rsi_ma'].iloc[i-1] and df[str(ma1)+'ma'].iloc[i-2] < df[str(ma1)+'ma'].iloc[i-1]:
                        BUY_PRICE = DolPaSt
                        IsDolpaDay = True
                        IsMaDone = True




            #ë¹„íŠ¸ì½”ì¸ì¼ ë•Œ
            else:

                
                #ê°€ì¥ ë†’ì€ ì´í‰ì„ ì˜ ê°’ì´ ê°€ì¥ ê¸´ ê¸°ê°„ì˜ ì´í‰ì„ ì¼ë•Œ
                #ê·¸ ì „ì¼ ì´í‰ì„  ê°’ì„ í˜„ì¬ê°€ê°€ ë„˜ì—ˆë‹¤ë©´ ëŒíŒŒ ë§¤ìˆ˜ë¥¼ í•œë‹¤!!!
                DolPaSt = max(df[str(ma1)+'ma'].iloc[i-1],df[str(ma2)+'ma'].iloc[i-1],df[str(ma3)+'ma'].iloc[i-1])

                if DolPaSt == df[str(ma3)+'ma'].iloc[i-1] and df['high'].iloc[i] >= DolPaSt and NowOpenPrice < DolPaSt:

                    #ë¹„íŠ¸ì½”ì¸ì€ ì¶”ê°€ ì¡°ê±´ ì²´í¬ ì—†ì´ ê·¸ëƒ¥ ëŒíŒŒí–ˆìœ¼ë©´ ë§¤ìˆ˜!
                    BUY_PRICE = DolPaSt
                    IsDolpaDay = True
                    IsMaDone = True
                else:
                

                    #2ì—°ì† ì–‘ë´‰ì´ë©´ì„œ ê³ ê°€ë„ ì¦ê°€ë˜ëŠ”ë° 5ì¼ì„ ì´ ì¦ê°€ë˜ê³  ìˆìœ¼ë©´ì„œ 10ì¼ì„ ,60ì¼ì„  ìœ„ì— ìˆì„ ë•Œ ë¹„íŠ¸ ë§¤ìˆ˜!
                    if df['open'].iloc[i-1] < df['close'].iloc[i-1] and df['open'].iloc[i-2] < df['close'].iloc[i-2] and df['close'].iloc[i-2] < df['close'].iloc[i-1]   and df['high'].iloc[i-2] < df['high'].iloc[i-1] and df['3ma'].iloc[i-2] < df['3ma'].iloc[i-1] and df['20ma'].iloc[i-1] < df['close'].iloc[i-1] and df['70ma'].iloc[i-1] < df['close'].iloc[i-1] :
                        
                        BUY_PRICE = NowOpenPrice
                        IsDolpaDay = False
                        IsMaDone = True


                if IsMaDone == False:


                    DolpaRate = 0.7

                    DolPaSt = NowOpenPrice + (((max(df['high'].iloc[i-1],df['high'].iloc[i-2])- min(df['low'].iloc[i-1],df['low'].iloc[i-2])) * DolpaRate))

                    if df['high'].iloc[i] >= DolPaSt and NowOpenPrice < DolPaSt and df[str(ma2)+'ma'].iloc[i-2] < PrevClosePrice and df['low'].iloc[i-2] < df['low'].iloc[i-1] and df['rsi_ma'].iloc[i-2] < df['rsi_ma'].iloc[i-1] and df[str(ma3)+'ma'].iloc[i-2] < df[str(ma2)+'ma'].iloc[i-1] < df[str(ma1)+'ma'].iloc[i-1] :
                        BUY_PRICE = DolPaSt
                        IsDolpaDay = True
                        IsMaDone = True











            IsAdditionalCondition = False
            
            if coin_ticker == 'ETH':
                if (df['5ma'].iloc[i-2] <= df['5ma'].iloc[i-1] and df['5ma'].iloc[i-1] <= PrevClosePrice) and (df['24ma'].iloc[i-2] <= df['24ma'].iloc[i-1] and df['24ma'].iloc[i-1] <= PrevClosePrice):
                    IsAdditionalCondition = True
                        


            else:
                if (df['3ma'].iloc[i-2] <= df['3ma'].iloc[i-1] and df['3ma'].iloc[i-1] <= PrevClosePrice) and (df['33ma'].iloc[i-2] <= df['33ma'].iloc[i-1] and df['33ma'].iloc[i-1] <= PrevClosePrice):
                    IsAdditionalCondition = True
                    
            #ë„ì§€ ìº”ë“¤ íŒ¨í„´ ì²´í¬
            prev_high_low_gap = abs(df['high'].iloc[i-1] - df['low'].iloc[i-1])
            prev_open_close_gap = abs(df['open'].iloc[i-1] - df['close'].iloc[i-1])



            #ì‹œê°€ì™€ ì¢…ê°€ì˜ ê°­ì´ ê³ ê°€ì™€ ì €ê°€ì˜ ê°­ì˜ 10% ì´í•˜ë¼ë©´ ë„ì§€ ìº”ë“¤ë¡œ íŒë‹¨
            if (prev_high_low_gap > 0 and (prev_open_close_gap / prev_high_low_gap) <= 0.1) :
                IsMaDone = False


                
                
            #ì´í‰ì„  ì¡°ê±´ì„ ë§Œì¡±í•œë‹¤ë©´..
            if IsMaDone == True and IsAdditionalCondition == True :
 
                Rate = 1.0

                ########################################################################################################
                ''' #ì´ ë¶€ë¶„ì„ ì£¼ì„ì²˜ë¦¬ í•˜ë©´ ê°ì‚° ë¡œì§ì´ ì œê±° ë©ë‹ˆë‹¤ 
                #50ì¼ì„ ì´ ê°ì†Œì¤‘ì´ê±°ë‚˜ 50ì¼ì„  ë°‘ì— ìˆë‹¤ë©´ íˆ¬ìë¹„ì¤‘ ì ˆë°˜ìœ¼ë¡œ ì¤„ì—¬ì¤Œ!
                if df['50ma'].iloc[i-2] > df['50ma'].iloc[i-1] or df['50ma'].iloc[i-1] > df['close'].iloc[i-1]:
                    Rate *= 0.5

                '''
                ########################################################################################################


                InvestGoMoney = RemainInvestMoney*Rate * (1.0 - fee) #ìˆ˜ìˆ˜ë£Œë¥¼ ì œì™¸í•œ ê¸ˆì•¡ì„ íˆ¬ìí•œë‹¤!
                IsBuyGo = True




            if IsBuyGo == True :

                #íˆ¬ìê¸ˆ ê±°ë˜ëŒ€ê¸ˆ 10ì¼ í‰ê· ì˜ 1/2000ìˆ˜ì¤€ìœ¼ë¡œ ì œí•œ!
                #'''
                if InvestGoMoney > df['value_ma'].iloc[i-1] / 2000:
                    InvestGoMoney = df['value_ma'].iloc[i-1]/ 2000

                if InvestGoMoney < 10000:
                    InvestGoMoney = 10000
                #'''

                BuyAmt = float(InvestGoMoney /  BUY_PRICE) #ë§¤ìˆ˜ ê°€ëŠ¥ ìˆ˜ëŸ‰ì„ êµ¬í•œë‹¤!

                NowFee = (BuyAmt*BUY_PRICE) * fee

                TotalBuyAmt += BuyAmt
                TotalPureMoney += (BuyAmt*BUY_PRICE)

                RealInvestMoney += (BuyAmt*BUY_PRICE) #ì‹¤ì œ ë“¤ì–´ê°„ íˆ¬ìê¸ˆ


                RemainInvestMoney -= (BuyAmt*BUY_PRICE) #ë‚¨ì€ íˆ¬ìê¸ˆ!
                RemainInvestMoney -= NowFee

                InvestMoney = RealInvestMoney + RemainInvestMoney  #ì‹¤ì œ ì”ê³ ëŠ” ì‹¤ì œ ë“¤ì–´ê°„ íˆ¬ìê¸ˆ + ë‚¨ì€ íˆ¬ìê¸ˆ!

                
                AvgPrice = BUY_PRICE

                if IsDolpaDay == True:

                    print(coin_ticker ," ", df.iloc[i].name,  "íšŒì°¨ >>>> !!!ëŒíŒŒ!!! ë§¤ìˆ˜ìˆ˜ëŸ‰:", BuyAmt ,"ëˆ„ì ìˆ˜ëŸ‰:",TotalBuyAmt," í‰ë‹¨: ",round(AvgPrice,2)," >>>>>>> ë§¤ìˆ˜ì‹œì‘! \níˆ¬ìê¸ˆ ìˆ˜ìµë¥ : 0% ,ì¢…ëª© ì”ê³ :",round(RemainInvestMoney,2), "+",round(RealInvestMoney,2), "=",round(InvestMoney,2)  , " ë§¤ìˆ˜ê°€ê²©:", round(BUY_PRICE,2),"\n")
                
                else:

                    print(coin_ticker ," ", df.iloc[i].name,  "íšŒì°¨ >>>> ë§¤ìˆ˜ìˆ˜ëŸ‰:", BuyAmt ,"ëˆ„ì ìˆ˜ëŸ‰:",TotalBuyAmt," í‰ë‹¨: ",round(AvgPrice,2)," >>>>>>> ë§¤ìˆ˜ì‹œì‘! \níˆ¬ìê¸ˆ ìˆ˜ìµë¥ : 0% ,ì¢…ëª© ì”ê³ :",round(RemainInvestMoney,2), "+",round(RealInvestMoney,2), "=",round(InvestMoney,2)  , " ë§¤ìˆ˜ê°€ê²©:", round(BUY_PRICE,2),"\n")
                
                IsBuy = True #ë§¤ìˆ˜í–ˆë‹¤
                print("\n")


        InvestMoney = RealInvestMoney + RemainInvestMoney 
        TotalMoneyList.append(InvestMoney)
        

    #####################################################
    #####################################################
    #####################################################
    #'''
  


    #ê²°ê³¼ ì •ë¦¬ ë° ë°ì´í„° ë§Œë“¤ê¸°!!
    if len(TotalMoneyList) > 0:
        TotalResultDict[coin_ticker] = TotalMoneyList
        resultData = dict()

        
        resultData['Ticker'] = coin_ticker


        result_df = pd.DataFrame({ "Total_Money" : TotalMoneyList}, index = df.index)

        result_df['Ror'] = result_df['Total_Money'].pct_change() + 1
        result_df['Cum_Ror'] = result_df['Ror'].cumprod()

        result_df['Highwatermark'] =  result_df['Cum_Ror'].cummax()
        result_df['Drawdown'] = (result_df['Cum_Ror'] / result_df['Highwatermark']) - 1
        result_df['MaxDrawdown'] = result_df['Drawdown'].cummin()

        print(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")
        pprint.pprint(result_df)
        print(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>")

        resultData['DateStr'] = str(FirstDateStr) + " ~ " + str(result_df.iloc[-1].name)

        resultData['OriMoney'] = result_df['Total_Money'].iloc[FirstDateIndex]
        resultData['FinalMoney'] = result_df['Total_Money'].iloc[-1]
        resultData['OriRevenueHold'] =  (df['open'].iloc[-1]/df['open'].iloc[FirstDateIndex] - 1.0) * 100.0 
        resultData['RevenueRate'] = ((result_df['Cum_Ror'].iloc[-1] -1.0)* 100.0)
        resultData['MDD'] = result_df['MaxDrawdown'].min() * 100.0


        resultData['TryCnt'] = TryCnt
        resultData['SuccessCnt'] = SuccessCnt
        resultData['FailCnt'] = FailCnt

        ResultList.append(resultData)



        for idx, row in result_df.iterrows():
            print(idx, " " , row['Total_Money'], " "  , row['Cum_Ror'])
            





#ë°ì´í„°ë¥¼ ë³´ê¸°ì¢‹ê²Œ í”„ë¦°íŠ¸ í•´ì£¼ëŠ” ë¡œì§!
print("\n\n--------------------")
TotalOri = 0
TotalFinal = 0
TotalHoldRevenue = 0
TotalMDD= 0

InvestCnt = float(len(ResultList))

for result in ResultList:

    print("--->>>",result['DateStr'].replace("00:00:00",""),"<<<---")
    print(result['Ticker'] )
    print("ìµœì´ˆ ê¸ˆì•¡: ", str(format(round(result['OriMoney']), ',')) , " ìµœì¢… ê¸ˆì•¡: ", str(format(round(result['FinalMoney']), ','))  )
    print("ìˆ˜ìµë¥ :", format(round(result['RevenueRate'],2),',') , "%")
    print("ë‹¨ìˆœ ë³´ìœ  ìˆ˜ìµë¥ :", format(round(result['OriRevenueHold'],2),',') , "%")
    print("MDD:", round(result['MDD'],2) , "%")

    if result['TryCnt'] > 0:
        print("ì„±ê³µ:", result['SuccessCnt'] , " ì‹¤íŒ¨:", result['FailCnt']," -> ìŠ¹ë¥ : ", round(result['SuccessCnt']/result['TryCnt'] * 100.0,2) ," %")



    TotalHoldRevenue += result['OriRevenueHold']


    print("\n--------------------\n")

if len(ResultList) > 0:
    print("####################################")
    

    # ë”•ì…”ë„ˆë¦¬ì˜ ë¦¬ìŠ¤íŠ¸ë“¤ì˜ ê¸¸ì´ë¥¼ ê°€ì ¸ì˜´
    length = len(list(TotalResultDict.values())[0])

    # ì¢…í•© ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
    FinalTotalMoneyList = [0] * length

    # ë”•ì…”ë„ˆë¦¬ì—ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ í•©ì‚°
    for my_list in TotalResultDict.values():
        # ë¦¬ìŠ¤íŠ¸ì˜ ê° ìš”ì†Œë¥¼ í•©ì‚°
        for i, value in enumerate(my_list):
            FinalTotalMoneyList[i] += value


    result_df = pd.DataFrame({ "Total_Money" : FinalTotalMoneyList}, index = df.index)

    result_df['Ror'] = result_df['Total_Money'].pct_change() + 1
    result_df['Cum_Ror'] = result_df['Ror'].cumprod()

    result_df['Highwatermark'] =  result_df['Cum_Ror'].cummax()
    result_df['Drawdown'] = (result_df['Cum_Ror'] / result_df['Highwatermark']) - 1
    result_df['MaxDrawdown'] = result_df['Drawdown'].cummin()

    result_df.index = pd.to_datetime(result_df.index)


    #'''
    # Create a figure with subplots for the two charts
    fig, axs = plt.subplots(2, 1, figsize=(10, 10))

    # Plot the return chart
    axs[0].plot(result_df['Cum_Ror'] * 100, label='Strategy')
    axs[0].set_ylabel('Cumulative Return (%)')
    axs[0].set_title('Return Comparison Chart')
    axs[0].legend()

    # Plot the MDD and DD chart on the same graph
    axs[1].plot(result_df.index, result_df['MaxDrawdown'] * 100, label='MDD')
    axs[1].plot(result_df.index, result_df['Drawdown'] * 100, label='Drawdown')
    axs[1].set_ylabel('Drawdown (%)')
    axs[1].set_title('Drawdown Comparison Chart')
    axs[1].legend()

    # Show the plot
    plt.tight_layout()
    plt.show()
        
    #'''
    
    
    
    TotalOri = result_df['Total_Money'].iloc[1]
    TotalFinal = result_df['Total_Money'].iloc[-1]

    TotalMDD = result_df['MaxDrawdown'].min() * 100.0 #MDDë¥¼ ì¢…í•©ì ìœ¼ë¡œ ê³„ì‚°!


    print("---------- ì´ ê²°ê³¼ ----------")
    print("ìµœì´ˆ ê¸ˆì•¡:", str(format(round(TotalOri), ','))  , " ìµœì¢… ê¸ˆì•¡:", str(format(round(TotalFinal), ',')), "\nìˆ˜ìµë¥ :", round(((TotalFinal - TotalOri) / TotalOri) * 100,2) ,"% (ë‹¨ìˆœë³´ìœ ìˆ˜ìµë¥ :" ,round(TotalHoldRevenue/InvestCnt,2) ,"%) í‰ê·  MDD:",  round(TotalMDD,2),"%")
    # CAGR ê³„ì‚° ì¶”ê°€
    start_date = pd.to_datetime(FirstDateStr)
    end_date = result_df.index[-1]
    years = (end_date - start_date).days / 365.25
    
    CAGR = (pow((TotalFinal / TotalOri), (1/years)) - 1) * 100
    print("CAGR(ì—°ë³µë¦¬ìˆ˜ìµë¥ ):", round(CAGR,2), "%")
    
    print("------------------------------")
    print("####################################")









