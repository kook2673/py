# 코스피 양방향매매 전략 (연복리 27%, MDD 낮음)

## 📋 프로젝트 개요

이 프로젝트는 한국투자증권 API를 활용한 코스피 지수 양방향 매매 자동화 시스템입니다. 레버리지 ETF와 인버스 ETF를 조합하여 상승장과 하락장 모두에서 수익을 추구하는 전략을 구현했습니다.

## 🎯 전략 성과
- **연복리**: 약 27%
- **MDD (Maximum Drawdown)**: 10~16%
- **투자 기간**: 약 6-7년 백테스트
- **승률**: 전략에 따라 변동

## 📁 파일 구조

### 핵심 파일들
- **`KIS_Common.py`**: 공통 유틸리티 함수들
  - API 인증 및 토큰 관리
  - OHLCV 데이터 수집 (한투 API, yfinance, FDR 등)
  - 기술적 지표 계산 (RSI, 이동평균, 볼린저밴드 등)
  - 자동 주문 관리 시스템

- **`KIS_API_Helper_KR.py`**: 한국 주식 API 헬퍼
  - 한국 주식 매수/매도 주문
  - 잔고 조회
  - 주문 내역 조회

- **`KIS_API_Helper_US.py`**: 미국 주식 API 헬퍼
  - 미국 주식 매수/매도 주문
  - 잔고 조회
  - 주문 내역 조회

### 전략 파일들
- **`KrStock_Test_Kospi_Bot.py`**: 백테스트용 봇
- **`KrStock_Kospi_Bot.py`**: 실제 매매용 봇

### 설정 파일
- **`myStockInfo.yaml`**: API 키 및 계좌 정보 설정

## 🔧 설정 방법

### 1. API 키 발급
1. 한국투자증권 Open API 신청
2. 모의투자 API 키 발급
3. `myStockInfo.yaml` 파일에 API 정보 입력

### 2. 계좌 정보 입력
```yaml
VIRTUAL_CANO: "12345678"        # 모의계좌번호 (8자리)
VIRTUAL_ACNT_PRDT_CD: "01"      # 모의계좌상품코드 (2자리)
```

### 3. 실행
```bash
cd "게만아소스/26.코스피_양방향매매_연복리27_MDD낮음"
python KrStock_Test_Kospi_Bot.py  # 백테스트
python KrStock_Kospi_Bot.py       # 실제 매매
```

## 📊 투자 전략 상세

### 투자 대상
- **122630**: 코스피 레버리지 ETF (50% 비중)
- **252670**: 코스피 인버스 ETF (50% 비중)

### 매수 조건

#### 인버스 ETF (252670)
```python
# 모든 조건을 만족해야 매수
1. 3일, 6일, 19일 이평선 모두 위에 있을 때
2. RSI < 70이고 RSI가 상승 중일 때
3. 60일 이평선 위에 있고 60일 이평선이 상승 중일 때
4. 3일 > 6일 > 19일 이평선 순서일 때
```

#### 레버리지 ETF (122630)
```python
# 모든 조건을 만족해야 매수
1. 전일 저가가 전전일 저가보다 높을 때
2. 20일 이평선 대비 괴리율이 98% 미만이거나 106% 초과일 때
3. RSI < 80일 때
```

### 매도 조건

#### 인버스 ETF
```python
# 괴리율에 따른 차별화된 매도 조건
if 괴리율 > 105%:
    if 종가 < 3일 이평선: 매도
else:
    if 종가 < 6일 이평선 and 종가 < 19일 이평선: 매도
```

#### 레버리지 ETF
```python
# 기술적 조건 확인 후 매도
if (전일 저가 < 전전일 저가 or 거래량 < 3일 평균) and (괴리율 < 98% or 괴리율 > 105%):
    매도
```

### 비용 구조
- **수수료**: 매수/매도마다 0.15% (수수료 + 세금 + 슬리피지)
- **투자 금액**: 1천만원 기준

## 📈 백테스트 결과

### 데이터 기간
- **기간**: 1600일 (약 6-7년)
- **시작일**: 2021년 8월 3일
- **종료일**: 현재 (2024년 기준)
- **데이터 소스**: 한국투자증권 API + yfinance + FDR
- **기술적 지표**: RSI(14), 이동평균선(3,6,19,20,60일)

### 성과 지표
- **총 수익률**: 약 27% (연복리)
- **MDD**: 10~16%
- **매매 횟수**: 전략에 따라 변동
- **승률**: 전략에 따라 변동

## ⚠️ 주의사항

1. **투자 위험**: 이 전략은 학습 및 테스트 목적으로 제공됩니다.
2. **실제 투자**: 모든 투자 판단 및 실행은 사용자 본인의 책임입니다.
3. **API 제한**: 한국투자증권 API 사용량 제한을 확인하세요.
4. **시장 상황**: 과거 성과가 미래 성과를 보장하지 않습니다.

## 🔗 참고 자료

- [연복리 26%의 MDD 10~16의 강력한 코스피 지수 양방향 매매 전략!](https://blog.naver.com/zacra/223085637779)
- [주식/코인 자동매매 FAQ](https://blog.naver.com/zacra/223203988739)
- [백테스팅 가이드](https://blog.naver.com/zacra/223180500307)

## 📞 문의

기술적인 문제는 클래스101 강의 댓글이나 블로그 댓글로 문의해주세요.
- 파이썬 코딩 관련 답변만 가능합니다
- 현행법상 투자 관련 질문은 답변 불가합니다

---

**📌 면책조항**: 이 코드는 특정 종목 추천이나 투자 권유를 위한 것이 아닙니다. 제공된 전략은 학습 및 테스트 목적으로 구성된 예시 코드이며, 실제 투자 판단 및 실행은 전적으로 사용자 본인의 책임입니다. 